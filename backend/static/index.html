<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MotoFlash - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.12);
            --glass-shadow: rgba(0, 0, 0, 0.2);
            --accent-orange: #ff6b00;
            --accent-orange-light: #ff8c42;
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            min-height: 100vh;
            background: #0a0a0f;
            overflow-x: hidden;
        }

        /* Background com imagem */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .background img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center bottom;
            filter: brightness(0.5) saturate(1.1);
        }

        .background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                135deg,
                rgba(10, 10, 15, 0.7) 0%,
                rgba(10, 10, 15, 0.5) 50%,
                rgba(10, 10, 15, 0.7) 100%
            );
        }

        /* Text gradient */
        .text-gradient-orange {
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c42 50%, #ffad42 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ============ SIDEBAR ============ */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: rgba(15, 15, 20, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.08);
            z-index: 100;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .sidebar-nav {
            flex: 1;
            padding: 16px 12px;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, 0.4);
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(255, 107, 0, 0.2) 0%, rgba(255, 140, 66, 0.15) 100%);
            color: #ff8c42;
            border: 1px solid rgba(255, 107, 0, 0.3);
        }

        .nav-item.active .nav-icon {
            color: #ff6b00;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .nav-badge {
            margin-left: auto;
            background: rgba(255, 107, 0, 0.2);
            color: #ff8c42;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }

        .user-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, #ff6b00 0%, #ff8c42 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 16px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: #fff;
            font-size: 14px;
        }

        .user-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
        }

        .status-dot.offline {
            background: #ef4444;
        }

        /* ============ MAIN CONTENT ============ */
        .main-wrapper {
            margin-left: var(--sidebar-width);
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        .glass-header {
            background: rgba(15, 15, 20, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        .glass-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .glass-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .glass-input:focus {
            outline: none;
            border-color: rgba(255, 107, 0, 0.5);
            background: rgba(255, 255, 255, 0.12);
        }

        .glass-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .glass-select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        .glass-select option {
            background: #1a1a2e;
            color: #fff;
        }

        .btn-primary {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--accent-orange) 0%, #ff8c42 100%);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.35);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .glass-btn {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.25);
        }

        .badge-warning {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.25);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.25);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.25);
        }

        .badge-purple {
            background: rgba(147, 51, 234, 0.15);
            color: #a78bfa;
            border: 1px solid rgba(147, 51, 234, 0.25);
        }

        .badge-gray {
            background: rgba(156, 163, 175, 0.15);
            color: #9ca3af;
            border: 1px solid rgba(156, 163, 175, 0.25);
        }

        /* Courier avatar */
        .courier-avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        /* Stats cards */
        .stat-card {
            background: rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'Outfit', sans-serif;
        }

        .stat-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
        }

        /* Alerts panel */
        .alert-item {
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid;
        }

        .alert-critico {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .alert-atencao {
            background: rgba(251, 191, 36, 0.1);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .alert-sucesso {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
        }

        /* Mobile */
        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-wrapper {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: flex !important;
            }
        }

        .mobile-menu-btn {
            display: none;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Autocomplete dropdown */
        .autocomplete-dropdown {
            position: absolute;
            z-index: 50;
            width: 100%;
            margin-top: 4px;
            background: rgba(30, 30, 40, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            max-height: 200px;
            overflow-y: auto;
        }

        .autocomplete-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            transition: background 0.2s;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
        }

        .autocomplete-item:hover {
            background: rgba(255, 107, 0, 0.15);
        }

        /* Customer found card */
        .customer-found-card {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 16px;
        }

        /* Modal overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .modal-content {
            background: rgba(25, 25, 35, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 24px;
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="background">
        <img src="/static/fundo/cidade_3.jpg" alt="City Background">
    </div>

    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;
        
        // ============ CONFIGURA√á√ÉO ============
        const API_URL = window.location.origin;
        
        // ============ AUTENTICA√á√ÉO ============
        
        const getToken = () => localStorage.getItem('motoflash_token');
        const isLoggedIn = () => !!getToken();
        
        const authFetch = async (url, options = {}) => {
            const token = getToken();
            
            if (!token) {
                window.location.href = '/login';
                throw new Error('N√£o autenticado');
            }
            
            const headers = {
                ...options.headers,
                'Authorization': `Bearer ${token}`
            };
            
            if (options.body && typeof options.body === 'string') {
                headers['Content-Type'] = 'application/json';
            }
            
            const response = await fetch(url, { ...options, headers });
            
            if (response.status === 401) {
                localStorage.removeItem('motoflash_token');
                localStorage.removeItem('motoflash_user');
                localStorage.removeItem('motoflash_restaurant');
                window.location.href = '/login';
                throw new Error('Sess√£o expirada');
            }
            
            return response;
        };
        
        // Verifica login ao carregar
        if (!isLoggedIn()) {
            window.location.href = '/login';
        }
        
        // ============ COMPONENTES AUXILIARES ============
        
        // Cron√¥metro
        const Timer = ({ startTime }) => {
            const [elapsed, setElapsed] = useState(0);
            
            useEffect(() => {
                if (!startTime) return;
                
                let dateString = startTime;
                if (!dateString.endsWith('Z') && !dateString.includes('+')) {
                    dateString = dateString + 'Z';
                }
                
                const start = new Date(dateString).getTime();
                
                const updateTimer = () => {
                    const now = Date.now();
                    const diff = Math.floor((now - start) / 1000);
                    setElapsed(Math.max(0, diff));
                };
                
                updateTimer();
                const interval = setInterval(updateTimer, 1000);
                
                return () => clearInterval(interval);
            }, [startTime]);
            
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            let colorClass = 'badge-success';
            if (minutes >= 15) colorClass = 'badge-warning';
            if (minutes >= 25) colorClass = 'badge-danger';
            
            return (
                <span className={`badge ${colorClass} font-mono`}>
                    ‚è±Ô∏è {String(minutes).padStart(2, '0')}:{String(seconds).padStart(2, '0')}
                </span>
            );
        };
        
        // Badge de Status
        const StatusBadge = ({ status }) => {
            const config = {
                created: { class: 'badge-gray', label: 'Criado' },
                preparing: { class: 'badge-warning', label: 'Preparando' },
                ready: { class: 'badge-success', label: 'Pronto' },
                assigned: { class: 'badge-info', label: 'Atribu√≠do' },
                picked_up: { class: 'badge-purple', label: 'Coletado' },
                delivered: { class: 'badge-success', label: 'Entregue' },
                available: { class: 'badge-success', label: 'Dispon√≠vel' },
                busy: { class: 'badge-warning', label: 'Em entrega' },
                offline: { class: 'badge-gray', label: 'Offline' },
            };
            
            const { class: badgeClass, label } = config[status] || { class: 'badge-gray', label: status };
            
            return <span className={`badge ${badgeClass}`}>{label}</span>;
        };
        
        // ============ COMPONENTE: STATS PANEL ============
        
        const StatsPanel = ({ stats }) => {
            if (!stats) return null;
            
            const items = [
                { value: stats.orders?.ready || 0, label: 'Prontos', color: '#ff8c42' },
                { value: stats.orders?.assigned || 0, label: 'Em Rota', color: '#60a5fa' },
                { value: stats.couriers?.available || 0, label: 'Motoboys Livres', color: '#4ade80' },
                { value: stats.couriers?.busy || 0, label: 'Ocupados', color: '#a78bfa' },
                { value: stats.orders?.delivered || 0, label: 'Entregues Hoje', color: '#34d399' },
            ];
            
            return (
                <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                    {items.map((item, idx) => (
                        <div key={idx} className="stat-card">
                            <div className="stat-value" style={{ color: item.color }}>{item.value}</div>
                            <div className="stat-label">{item.label}</div>
                        </div>
                    ))}
                </div>
            );
        };
        
        // ============ COMPONENTE: ALERTS PANEL ============
        
        const AlertsPanel = ({ alerts, recommendation }) => {
            if (!alerts) return null;
            
            const statusBgColors = {
                critico: '#ef4444',
                atencao: '#fbbf24',
                info: '#60a5fa',
                sucesso: '#4ade80',
            };
            
            return (
                <div className="glass-card p-5 mb-6">
                    <div className="flex items-center justify-between mb-4">
                        <h3 className="font-semibold text-white flex items-center gap-2" style={{ fontFamily: 'Outfit, sans-serif' }}>
                            üß† Intelig√™ncia MotoFlash
                        </h3>
                        {recommendation && (
                            <div className="flex items-center gap-2 text-sm">
                                <span style={{ color: 'rgba(255,255,255,0.5)' }}>Motoboys recomendados:</span>
                                <span 
                                    className="px-3 py-1 rounded-full font-bold text-white"
                                    style={{ background: statusBgColors[alerts.status_geral] || '#60a5fa' }}
                                >
                                    {recommendation.motoboys_recomendados}
                                </span>
                            </div>
                        )}
                    </div>
                    
                    {/* Alertas */}
                    <div className="space-y-2 mb-4">
                        {alerts.alertas?.map((alerta, idx) => (
                            <div key={idx} className={`alert-item alert-${alerta.tipo}`}>
                                <div className="flex items-start gap-3">
                                    <span className="text-xl">{alerta.icone}</span>
                                    <div className="flex-1">
                                        <div className="font-semibold text-white">{alerta.titulo}</div>
                                        <div className="text-sm" style={{ color: 'rgba(255,255,255,0.7)' }}>{alerta.mensagem}</div>
                                        {alerta.acao_sugerida && (
                                            <div className="text-sm mt-1 font-medium" style={{ color: '#fbbf24' }}>
                                                üí° {alerta.acao_sugerida}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                    
                    {/* M√©tricas */}
                    {recommendation && (
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 pt-4" style={{ borderTop: '1px solid rgba(255,255,255,0.1)' }}>
                            <div className="text-center">
                                <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '12px' }}>Tempo preparo</div>
                                <div className="font-semibold text-white">
                                    {recommendation.tempo_medio_preparo ? `${recommendation.tempo_medio_preparo} min` : '-'}
                                </div>
                            </div>
                            <div className="text-center">
                                <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '12px' }}>Tempo rota</div>
                                <div className="font-semibold text-white">
                                    {recommendation.tempo_medio_rota ? `${recommendation.tempo_medio_rota} min` : '-'}
                                </div>
                            </div>
                            <div className="text-center">
                                <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '12px' }}>Pedidos/hora</div>
                                <div className="font-semibold text-white">{recommendation.pedidos_por_hora || '-'}</div>
                            </div>
                            <div className="text-center">
                                <div style={{ color: 'rgba(255,255,255,0.5)', fontSize: '12px' }}>Capacidade/motoboy</div>
                                <div className="font-semibold text-white">
                                    {recommendation.capacidade_por_motoboy ? `${recommendation.capacidade_por_motoboy}/h` : '-'}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // ============ COMPONENTE: FORMUL√ÅRIO DE NOVO PEDIDO ============
        
        const NewOrderForm = ({ onOrderCreated, simulatedDate }) => {
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState('');
            const [errorMsg, setErrorMsg] = useState('');
            
            // Campos do formul√°rio
            const [phone, setPhone] = useState('');
            const [customerName, setCustomerName] = useState('');
            const [selectedItemId, setSelectedItemId] = useState('');
            
            // Campos de endere√ßo
            const [cep, setCep] = useState('');
            const [street, setStreet] = useState('');
            const [number, setNumber] = useState('');
            const [neighborhood, setNeighborhood] = useState('');
            const [city, setCity] = useState('Ribeir√£o Preto');
            const [complement, setComplement] = useState('');
            const [loadingCep, setLoadingCep] = useState(false);
            
            // Cliente encontrado
            const [foundCustomer, setFoundCustomer] = useState(null);
            const [searchingCustomer, setSearchingCustomer] = useState(false);
            const [useOtherAddress, setUseOtherAddress] = useState(false);
            
            // Sugest√µes
            const [nameSuggestions, setNameSuggestions] = useState([]);
            const [showNameSuggestions, setShowNameSuggestions] = useState(false);
            
            // Autocomplete de endere√ßo (Photon)
            const [streetSuggestions, setStreetSuggestions] = useState([]);
            const [showStreetSuggestions, setShowStreetSuggestions] = useState(false);
            const [neighborhoodSuggestions, setNeighborhoodSuggestions] = useState([]);
            const [showNeighborhoodSuggestions, setShowNeighborhoodSuggestions] = useState(false);
            
            // Card√°pio
            const [menuData, setMenuData] = useState([]);
            const [loadingMenu, setLoadingMenu] = useState(true);
            
            // Formata telefone
            const formatPhone = (value) => {
                const numbers = value.replace(/\D/g, '');
                if (numbers.length <= 2) return `(${numbers}`;
                if (numbers.length <= 7) return `(${numbers.slice(0,2)}) ${numbers.slice(2)}`;
                return `(${numbers.slice(0,2)}) ${numbers.slice(2,7)}-${numbers.slice(7,11)}`;
            };
            
            // Formata CEP
            const formatCep = (value) => {
                const numbers = value.replace(/\D/g, '');
                if (numbers.length <= 5) return numbers;
                return `${numbers.slice(0,5)}-${numbers.slice(5,8)}`;
            };
            
            // Busca CEP
            const handleCepChange = async (e) => {
                const formatted = formatCep(e.target.value);
                setCep(formatted);
                
                const numbers = formatted.replace(/\D/g, '');
                
                if (numbers.length === 8) {
                    setLoadingCep(true);
                    try {
                        const res = await fetch(`https://viacep.com.br/ws/${numbers}/json/`);
                        if (res.ok) {
                            const data = await res.json();
                            if (!data.erro) {
                                setStreet(data.logradouro || '');
                                setNeighborhood(data.bairro || '');
                                setCity(data.localidade || '');
                                setTimeout(() => document.getElementById('numberInput')?.focus(), 100);
                            }
                        }
                    } catch (err) {
                        console.error('Erro ViaCEP:', err);
                    }
                    setLoadingCep(false);
                }
            };
            
            // Remove acentos para API Photon
            const removeAccents = (str) => str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            
            // Busca sugest√µes no Photon
            const searchPhoton = async (query, type) => {
                if (query.trim().length < 3) return [];
                
                try {
                    const cleanQuery = removeAccents(query);
                    const fullQuery = `${cleanQuery} ${removeAccents(city || 'Ribeirao Preto')}`;
                    
                    const res = await fetch(
                        `https://photon.komoot.io/api/?q=${encodeURIComponent(fullQuery)}&limit=5&lat=-21.17&lon=-47.80`
                    );
                    
                    if (res.ok) {
                        const data = await res.json();
                        if (data.features && data.features.length > 0) {
                            const values = new Set();
                            data.features.forEach(f => {
                                const p = f.properties;
                                if (type === 'street') {
                                    const name = p.name || p.street;
                                    if (name) values.add(name);
                                } else if (type === 'neighborhood') {
                                    const bairro = p.suburb || p.district || p.locality || p.neighbourhood;
                                    if (bairro && bairro !== p.city) values.add(bairro);
                                }
                            });
                            return Array.from(values);
                        }
                    }
                } catch (err) {
                    console.error('Erro Photon:', err);
                }
                return [];
            };
            
            // Autocomplete de Rua
            const handleStreetChange = async (e) => {
                const value = e.target.value;
                setStreet(value);
                
                const suggestions = await searchPhoton(value, 'street');
                setStreetSuggestions(suggestions);
                setShowStreetSuggestions(suggestions.length > 0);
            };
            
            // Autocomplete de Bairro
            const handleNeighborhoodChange = async (e) => {
                const value = e.target.value;
                setNeighborhood(value);
                
                const suggestions = await searchPhoton(value, 'neighborhood');
                setNeighborhoodSuggestions(suggestions);
                setShowNeighborhoodSuggestions(suggestions.length > 0);
            };
            
            // Busca cliente por telefone
            const handlePhoneChange = async (e) => {
                const formatted = formatPhone(e.target.value);
                setPhone(formatted);
                
                const numbers = formatted.replace(/\D/g, '');
                
                if (numbers.length >= 10) {
                    setSearchingCustomer(true);
                    try {
                        const res = await authFetch(`${API_URL}/customers/phone/${numbers}`);
                        if (res.ok) {
                            const customer = await res.json();
                            selectCustomer(customer);
                            setStatus('‚úÖ Cliente encontrado!');
                            setTimeout(() => setStatus(''), 2000);
                        } else {
                            setFoundCustomer(null);
                            setUseOtherAddress(false);
                        }
                    } catch (err) {
                        setFoundCustomer(null);
                    }
                    setSearchingCustomer(false);
                } else {
                    setFoundCustomer(null);
                    setUseOtherAddress(false);
                }
            };
            
            // Busca clientes por nome
            const handleNameChange = async (e) => {
                const value = e.target.value;
                setCustomerName(value);
                setFoundCustomer(null);
                
                if (value.trim().length >= 2) {
                    try {
                        const res = await authFetch(`${API_URL}/customers?search=${encodeURIComponent(value)}`);
                        if (res.ok) {
                            const customers = await res.json();
                            setNameSuggestions(customers.slice(0, 5));
                            setShowNameSuggestions(customers.length > 0);
                        }
                    } catch (err) {
                        setNameSuggestions([]);
                    }
                } else {
                    setNameSuggestions([]);
                    setShowNameSuggestions(false);
                }
            };
            
            // Seleciona cliente
            const selectCustomer = (customer) => {
                setFoundCustomer(customer);
                setCustomerName(customer.name);
                setPhone(formatPhone(customer.phone));
                setComplement(customer.complement || '');
                setNameSuggestions([]);
                setShowNameSuggestions(false);
                setUseOtherAddress(false);
                
                if (customer.address) {
                    parseAddress(customer.address);
                }
            };
            
            // Parseia endere√ßo
            const parseAddress = (fullAddress) => {
                const dashParts = fullAddress.split(' - ');
                
                if (dashParts.length >= 2) {
                    const ruaENumero = dashParts[0];
                    const bairroECidade = dashParts.slice(1).join(' - ');
                    
                    const ruaParts = ruaENumero.split(',').map(p => p.trim());
                    if (ruaParts.length >= 2) {
                        setStreet(ruaParts[0]);
                        setNumber(ruaParts[1]);
                    } else {
                        setStreet(ruaParts[0]);
                    }
                    
                    const bairroParts = bairroECidade.split(',').map(p => p.trim());
                    if (bairroParts.length >= 2) {
                        setNeighborhood(bairroParts[0]);
                        setCity(bairroParts[1]);
                    } else if (bairroParts.length === 1) {
                        setNeighborhood(bairroParts[0]);
                    }
                } else {
                    const parts = fullAddress.split(',').map(p => p.trim());
                    if (parts.length >= 1) setStreet(parts[0]);
                    if (parts.length >= 2) setNumber(parts[1]);
                    if (parts.length >= 3) setNeighborhood(parts[2]);
                    if (parts.length >= 4) setCity(parts[3]);
                }
            };
            
            // Monta endere√ßo completo
            const getFullAddress = () => {
                let addr = street;
                if (number) addr += `, ${number}`;
                if (neighborhood) addr += ` - ${neighborhood}`;
                if (city) addr += `, ${city}`;
                return addr;
            };
            
            // Outro endere√ßo
            const handleUseOtherAddress = () => {
                setUseOtherAddress(true);
                setCep('');
                setStreet('');
                setNumber('');
                setNeighborhood('');
                setCity('Ribeir√£o Preto');
                setComplement('');
            };
            
            const handleUseCadastroAddress = () => {
                setUseOtherAddress(false);
                if (foundCustomer?.address) {
                    parseAddress(foundCustomer.address);
                }
                setComplement(foundCustomer?.complement || '');
            };
            
            // Busca card√°pio
            useEffect(() => {
                const fetchMenu = async () => {
                    try {
                        const res = await authFetch(`${API_URL}/menu/full`);
                        if (res.ok) {
                            const data = await res.json();
                            setMenuData(data);
                            setSelectedItemId('');
                        }
                    } catch (err) {
                        console.error('Erro ao buscar card√°pio:', err);
                    }
                    setLoadingMenu(false);
                };
                fetchMenu();
            }, []);
            
            const getSelectedItem = () => {
                for (const cat of menuData) {
                    const item = cat.items.find(i => i.id === selectedItemId);
                    if (item) return { ...item, categoryName: cat.name };
                }
                return null;
            };
            
            // Cria pedido
            const createOrder = async (e) => {
                e.preventDefault();
                
                if (!customerName.trim()) { setErrorMsg('Digite o nome do cliente'); return; }
                if (!selectedItemId) { setErrorMsg('Selecione um item do card√°pio'); return; }
                if (!street.trim()) { setErrorMsg('Digite a rua'); return; }
                if (!number.trim()) { setErrorMsg('Digite o n√∫mero'); return; }
                if (!city.trim()) { setErrorMsg('Digite a cidade'); return; }
                
                const fullAddress = getFullAddress();
                const selectedItem = getSelectedItem();
                
                setLoading(true);
                setErrorMsg('');
                setStatus('üîç Buscando coordenadas...');
                
                try {
                    // Se √© cliente novo, salva primeiro
                    if (!foundCustomer && phone.replace(/\D/g, '').length >= 10) {
                        try {
                            await authFetch(`${API_URL}/customers`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    phone: phone.replace(/\D/g, ''),
                                    name: customerName.trim(),
                                    address: fullAddress,
                                    complement: complement.trim() || null
                                })
                            });
                        } catch (err) { }
                    }
                    
                    // Cria pedido
                    const res = await authFetch(`${API_URL}/orders`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            customer_name: customerName.trim(),
                            address_text: fullAddress + (complement ? ` - ${complement}` : ''),
                            item: selectedItem ? selectedItem.name : 'Pedido',
                            prep_type: 'short',
                            simulated_date: simulatedDate,
                        }),
                    });
                    
                    if (!res.ok) {
                        const error = await res.json();
                        throw new Error(error.detail || 'Erro ao criar pedido');
                    }
                    
                    setStatus('‚úÖ Pedido criado com sucesso!');
                    // Limpa formul√°rio
                    setPhone('');
                    setCustomerName('');
                    setCep('');
                    setStreet('');
                    setNumber('');
                    setNeighborhood('');
                    setCity('Ribeir√£o Preto');
                    setComplement('');
                    setFoundCustomer(null);
                    setUseOtherAddress(false);
                    setSelectedItemId('');
                    onOrderCreated();
                    
                    setTimeout(() => setStatus(''), 3000);
                    
                } catch (err) {
                    console.error('Erro:', err);
                    setErrorMsg(`‚ùå ${err.message}`);
                }
                
                setLoading(false);
            };
            
            const hasMenuItems = menuData.some(cat => cat.items.length > 0);
            const showAddressFields = !foundCustomer || useOtherAddress;
            
            return (
                <div className="glass-card p-5 mb-6">
                    <div className="flex items-center justify-between mb-4">
                        <h3 className="font-semibold text-white flex items-center gap-2" style={{ fontFamily: 'Outfit, sans-serif' }}>
                            üì¶ Novo Pedido
                        </h3>
                        <span className="badge badge-success">Google Maps</span>
                    </div>
                    
                    <form onSubmit={createOrder}>
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            {/* Telefone */}
                            <div>
                                <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>
                                    Telefone do Cliente
                                    {searchingCustomer && <span className="ml-2" style={{ color: '#ff8c42' }}>üîç Buscando...</span>}
                                </label>
                                <input
                                    type="tel"
                                    value={phone}
                                    onChange={handlePhoneChange}
                                    placeholder="(16) 99999-1234"
                                    className="glass-input"
                                    maxLength={15}
                                    disabled={loading}
                                />
                            </div>
                            
                            {/* Nome */}
                            <div className="relative">
                                <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>
                                    Nome do Cliente
                                </label>
                                {foundCustomer && !useOtherAddress ? (
                                    <div className="customer-found-card">
                                        <div className="flex items-center gap-3">
                                            <span className="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold" style={{ background: '#22c55e' }}>
                                                {foundCustomer.name.charAt(0).toUpperCase()}
                                            </span>
                                            <div className="flex-1">
                                                <div className="font-semibold text-white">{foundCustomer.name}</div>
                                                <div className="text-sm" style={{ color: 'rgba(255,255,255,0.6)' }}>
                                                    üìç {foundCustomer.address}
                                                </div>
                                            </div>
                                        </div>
                                        <button
                                            type="button"
                                            onClick={handleUseOtherAddress}
                                            className="mt-3 w-full py-2 text-sm rounded-lg transition-colors"
                                            style={{ background: 'rgba(255,107,0,0.2)', color: '#ff8c42' }}
                                        >
                                            üìç Entregar em outro endere√ßo
                                        </button>
                                    </div>
                                ) : (
                                    <>
                                        <input
                                            type="text"
                                            value={customerName}
                                            onChange={handleNameChange}
                                            onBlur={() => setTimeout(() => setShowNameSuggestions(false), 200)}
                                            onFocus={() => nameSuggestions.length > 0 && setShowNameSuggestions(true)}
                                            placeholder="Digite o nome..."
                                            className="glass-input"
                                            disabled={loading}
                                            autoComplete="off"
                                        />
                                        
                                        {showNameSuggestions && nameSuggestions.length > 0 && (
                                            <div className="autocomplete-dropdown">
                                                {nameSuggestions.map(customer => (
                                                    <div
                                                        key={customer.id}
                                                        onClick={() => selectCustomer(customer)}
                                                        className="autocomplete-item flex items-center gap-3"
                                                    >
                                                        <span className="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold" style={{ background: 'rgba(255,107,0,0.2)', color: '#ff8c42' }}>
                                                            {customer.name.charAt(0).toUpperCase()}
                                                        </span>
                                                        <div>
                                                            <div className="font-medium text-white">{customer.name}</div>
                                                            <div className="text-xs" style={{ color: 'rgba(255,255,255,0.5)' }}>üìû {customer.phone}</div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>
                        </div>
                        
                        {/* Alerta outro endere√ßo */}
                        {foundCustomer && useOtherAddress && (
                            <div className="mb-4 p-3 rounded-lg" style={{ background: 'rgba(251,191,36,0.15)', border: '1px solid rgba(251,191,36,0.3)' }}>
                                <div className="flex items-center justify-between">
                                    <span style={{ color: '#fbbf24' }}>‚ö†Ô∏è Entrega em endere√ßo diferente do cadastro</span>
                                    <button
                                        type="button"
                                        onClick={handleUseCadastroAddress}
                                        className="text-sm"
                                        style={{ color: '#60a5fa' }}
                                    >
                                        ‚Ü©Ô∏è Usar endere√ßo do cadastro
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        <div className="grid md:grid-cols-2 gap-4 mb-4">
                            {/* Item */}
                            <div>
                                <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>Item</label>
                                {!hasMenuItems ? (
                                    <div className="p-3 rounded-lg" style={{ background: 'rgba(251,191,36,0.15)', border: '1px solid rgba(251,191,36,0.3)' }}>
                                        <span style={{ color: '#fbbf24' }}>‚ö†Ô∏è Nenhum item. </span>
                                        <a href="/cardapio" style={{ color: '#60a5fa' }}>Cadastrar card√°pio</a>
                                    </div>
                                ) : (
                                    <select
                                        value={selectedItemId}
                                        onChange={(e) => setSelectedItemId(e.target.value)}
                                        className="glass-select"
                                        disabled={loading}
                                    >
                                        <option value="">Selecione um item...</option>
                                        {menuData.map(cat => (
                                            <optgroup key={cat.id} label={cat.name}>
                                                {cat.items.map(item => (
                                                    <option key={item.id} value={item.id}>
                                                        {item.name}
                                                    </option>
                                                ))}
                                            </optgroup>
                                        ))}
                                    </select>
                                )}
                            </div>
                            
                            {/* CEP */}
                            {showAddressFields && (
                                <div>
                                    <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>
                                        CEP {loadingCep && <span style={{ color: '#ff8c42' }}>üîç</span>}
                                    </label>
                                    <input
                                        type="text"
                                        value={cep}
                                        onChange={handleCepChange}
                                        placeholder="14090-000"
                                        className="glass-input"
                                        maxLength={9}
                                        disabled={loading}
                                    />
                                </div>
                            )}
                        </div>
                        
                        {/* Endere√ßo */}
                        {showAddressFields && (
                            <div className="grid md:grid-cols-3 gap-4 mb-4">
                                <div className="md:col-span-2 relative">
                                    <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>Rua</label>
                                    <input
                                        type="text"
                                        value={street}
                                        onChange={handleStreetChange}
                                        onBlur={() => setTimeout(() => setShowStreetSuggestions(false), 200)}
                                        onFocus={() => streetSuggestions.length > 0 && setShowStreetSuggestions(true)}
                                        placeholder="Rua..."
                                        className="glass-input"
                                        disabled={loading}
                                        autoComplete="off"
                                    />
                                    {showStreetSuggestions && streetSuggestions.length > 0 && (
                                        <div className="autocomplete-dropdown">
                                            {streetSuggestions.map((suggestion, idx) => (
                                                <div
                                                    key={idx}
                                                    onClick={() => {
                                                        setStreet(suggestion);
                                                        setShowStreetSuggestions(false);
                                                    }}
                                                    className="autocomplete-item text-white"
                                                >
                                                    üìç {suggestion}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <div>
                                    <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>N√∫mero</label>
                                    <input
                                        id="numberInput"
                                        type="text"
                                        value={number}
                                        onChange={(e) => setNumber(e.target.value)}
                                        placeholder="123"
                                        className="glass-input"
                                        disabled={loading}
                                    />
                                </div>
                            </div>
                        )}
                        
                        {showAddressFields && (
                            <div className="grid md:grid-cols-3 gap-4 mb-4">
                                <div className="relative">
                                    <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>Bairro</label>
                                    <input
                                        type="text"
                                        value={neighborhood}
                                        onChange={handleNeighborhoodChange}
                                        onBlur={() => setTimeout(() => setShowNeighborhoodSuggestions(false), 200)}
                                        onFocus={() => neighborhoodSuggestions.length > 0 && setShowNeighborhoodSuggestions(true)}
                                        placeholder="Centro"
                                        className="glass-input"
                                        disabled={loading}
                                        autoComplete="off"
                                    />
                                    {showNeighborhoodSuggestions && neighborhoodSuggestions.length > 0 && (
                                        <div className="autocomplete-dropdown">
                                            {neighborhoodSuggestions.map((suggestion, idx) => (
                                                <div
                                                    key={idx}
                                                    onClick={() => {
                                                        setNeighborhood(suggestion);
                                                        setShowNeighborhoodSuggestions(false);
                                                    }}
                                                    className="autocomplete-item text-white"
                                                >
                                                    üèòÔ∏è {suggestion}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                <div>
                                    <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>Cidade</label>
                                    <input
                                        type="text"
                                        value={city}
                                        onChange={(e) => setCity(e.target.value)}
                                        placeholder="Ribeir√£o Preto"
                                        className="glass-input"
                                        disabled={loading}
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm mb-2" style={{ color: 'rgba(255,255,255,0.6)' }}>Complemento</label>
                                    <input
                                        type="text"
                                        value={complement}
                                        onChange={(e) => setComplement(e.target.value)}
                                        placeholder="Apto, Bloco..."
                                        className="glass-input"
                                        disabled={loading}
                                    />
                                </div>
                            </div>
                        )}
                        
                        {/* Status e Erro */}
                        {status && (
                            <div className="mb-4 p-3 rounded-lg" style={{ background: 'rgba(34,197,94,0.15)', border: '1px solid rgba(34,197,94,0.3)', color: '#4ade80' }}>
                                {status}
                            </div>
                        )}
                        
                        {errorMsg && (
                            <div className="mb-4 p-3 rounded-lg" style={{ background: 'rgba(239,68,68,0.15)', border: '1px solid rgba(239,68,68,0.3)', color: '#f87171' }}>
                                {errorMsg}
                            </div>
                        )}
                        
                        {/* Bot√£o */}
                        <div className="flex justify-end">
                            <button type="submit" disabled={loading || !hasMenuItems} className="btn-primary">
                                {loading ? '‚è≥ Criando...' : 'Criar Pedido'}
                            </button>
                        </div>
                    </form>
                </div>
            );
        };
        
        // ============ COMPONENTE: LISTA DE PEDIDOS (3 COLUNAS) ============
        
        const OrdersList = ({ orders, onRefresh }) => {
            const pendingOrders = orders.filter(o => ['created', 'preparing'].includes(o.status));
            const readyOrders = orders.filter(o => o.status === 'ready');
            const inRouteOrders = orders.filter(o => ['assigned', 'picked_up'].includes(o.status));
            
            const handleScan = async (orderId) => {
                try {
                    await authFetch(`${API_URL}/orders/${orderId}/scan`, { method: 'POST' });
                    onRefresh();
                } catch (err) {
                    console.error('Erro ao bipar:', err);
                }
            };
            
            const OrderCard = ({ order, showScan = false }) => (
                <div className="p-3 rounded-xl flex items-center justify-between" style={{ background: 'rgba(255,255,255,0.06)' }}>
                    <div className="flex-1">
                        <div className="flex items-center gap-2 flex-wrap">
                            <span className="font-medium text-white">{order.customer_name}</span>
                            {order.prep_type === 'long' && (
                                <span className="badge badge-warning text-xs">Demorado</span>
                            )}
                            {/* Cron√¥metro - mostra desde cria√ß√£o at√© ficar pronto */}
                            {['created', 'preparing'].includes(order.status) && order.created_at && (
                                <Timer startTime={order.created_at} />
                            )}
                            {/* Cron√¥metro - mostra tempo esperando motoboy */}
                            {order.status === 'ready' && order.ready_at && (
                                <Timer startTime={order.ready_at} />
                            )}
                        </div>
                        <div className="text-sm mt-1" style={{ color: 'rgba(255,255,255,0.5)' }}>
                            {order.address_text?.split(' - ')[0]}
                        </div>
                        {order.stop_order && (
                            <div className="text-xs mt-1" style={{ color: '#60a5fa' }}>Parada #{order.stop_order}</div>
                        )}
                    </div>
                    {showScan && (
                        <button 
                            onClick={() => handleScan(order.id)} 
                            className="ml-2 py-2 px-3 rounded-lg text-sm font-medium"
                            style={{ background: 'rgba(34, 197, 94, 0.15)', color: '#4ade80', border: '1px solid rgba(34, 197, 94, 0.3)' }}
                        >
                            üì± Bipar
                        </button>
                    )}
                </div>
            );
            
            return (
                <div className="grid md:grid-cols-3 gap-4 mb-6">
                    {/* Em Preparo */}
                    <div className="glass-card p-4">
                        <h3 className="font-semibold mb-3 flex items-center gap-2" style={{ color: '#fbbf24', fontFamily: 'Outfit, sans-serif' }}>
                            üßë‚Äçüç≥ Em Preparo ({pendingOrders.length})
                        </h3>
                        <div className="space-y-2 max-h-64 overflow-y-auto">
                            {pendingOrders.length === 0 ? (
                                <p className="text-sm text-center py-4" style={{ color: 'rgba(255,255,255,0.4)' }}>Nenhum pedido</p>
                            ) : (
                                pendingOrders.map(order => (
                                    <OrderCard key={order.id} order={order} showScan={true} />
                                ))
                            )}
                        </div>
                    </div>
                    
                    {/* Prontos */}
                    <div className="glass-card p-4" style={{ borderColor: 'rgba(34, 197, 94, 0.3)', borderWidth: '2px' }}>
                        <h3 className="font-semibold mb-3 flex items-center gap-2" style={{ color: '#4ade80', fontFamily: 'Outfit, sans-serif' }}>
                            ‚úÖ Prontos ({readyOrders.length})
                        </h3>
                        <div className="space-y-2 max-h-64 overflow-y-auto">
                            {readyOrders.length === 0 ? (
                                <p className="text-sm text-center py-4" style={{ color: 'rgba(255,255,255,0.4)' }}>Nenhum pedido</p>
                            ) : (
                                readyOrders.map(order => (
                                    <OrderCard key={order.id} order={order} />
                                ))
                            )}
                        </div>
                    </div>
                    
                    {/* Em Rota */}
                    <div className="glass-card p-4">
                        <h3 className="font-semibold mb-3 flex items-center gap-2" style={{ color: '#60a5fa', fontFamily: 'Outfit, sans-serif' }}>
                            üèçÔ∏è Em Rota ({inRouteOrders.length})
                        </h3>
                        <div className="space-y-2 max-h-64 overflow-y-auto">
                            {inRouteOrders.length === 0 ? (
                                <p className="text-sm text-center py-4" style={{ color: 'rgba(255,255,255,0.4)' }}>Nenhum pedido</p>
                            ) : (
                                inRouteOrders.map(order => (
                                    <OrderCard key={order.id} order={order} />
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // ============ COMPONENTE: PAINEL DE MOTOBOYS ============
        
        const CouriersPanel = ({ couriers, onRefresh }) => {
            const [showInviteModal, setShowInviteModal] = useState(false);
            const [inviteData, setInviteData] = useState(null);
            const [inviteLoading, setInviteLoading] = useState(false);
            const [copySuccess, setCopySuccess] = useState(false);
            
            // Menu de op√ß√µes
            const [openMenuId, setOpenMenuId] = useState(null);
            
            // Modal de recupera√ß√£o de senha
            const [showResetModal, setShowResetModal] = useState(false);
            const [resetData, setResetData] = useState(null);
            const [resetLoading, setResetLoading] = useState(false);
            const [resetCopySuccess, setResetCopySuccess] = useState(false);
            
            const toggleStatus = async (courier) => {
                const endpoint = courier.status === 'available' 
                    ? `${API_URL}/couriers/${courier.id}/offline`
                    : `${API_URL}/couriers/${courier.id}/available`;
                try {
                    await authFetch(endpoint, { method: 'POST' });
                    onRefresh();
                } catch (err) {
                    console.error('Erro:', err);
                }
            };
            
            const completeBatch = async (courierId) => {
                try {
                    await authFetch(`${API_URL}/couriers/${courierId}/complete-batch`, { method: 'POST' });
                    onRefresh();
                    setOpenMenuId(null);
                } catch (err) {
                    console.error('Erro:', err);
                }
            };
            
            const deleteCourier = async (courierId) => {
                if (!confirm('Tem certeza que deseja excluir este motoboy?')) return;
                try {
                    await authFetch(`${API_URL}/couriers/${courierId}`, { method: 'DELETE' });
                    onRefresh();
                    setOpenMenuId(null);
                } catch (err) {
                    console.error('Erro:', err);
                    alert('Erro ao excluir motoboy');
                }
            };
            
            const createPasswordReset = async (courier) => {
                setResetLoading(true);
                setOpenMenuId(null);
                try {
                    const res = await authFetch(`${API_URL}/couriers/${courier.id}/password-reset`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    
                    if (res.ok) {
                        const data = await res.json();
                        setResetData(data);
                        setShowResetModal(true);
                    }
                } catch (err) {
                    console.error('Erro ao gerar link:', err);
                    alert('Erro ao gerar link de recupera√ß√£o');
                }
                setResetLoading(false);
            };
            
            const copyResetLink = () => {
                if (resetData?.reset_url) {
                    navigator.clipboard.writeText(resetData.reset_url);
                    setResetCopySuccess(true);
                    setTimeout(() => setResetCopySuccess(false), 2000);
                }
            };
            
            const shareResetWhatsApp = () => {
                if (resetData?.reset_url) {
                    const text = `üîë Link para redefinir sua senha no MotoFlash:\n\n${resetData.reset_url}\n\n‚è±Ô∏è V√°lido por ${resetData.expires_in}`;
                    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
                }
            };
            
            const createInvite = async () => {
                setInviteLoading(true);
                try {
                    const res = await authFetch(`${API_URL}/invites`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    
                    if (res.ok) {
                        const data = await res.json();
                        setInviteData(data);
                        setShowInviteModal(true);
                    }
                } catch (err) {
                    console.error('Erro ao criar convite:', err);
                }
                setInviteLoading(false);
            };
            
            const copyLink = () => {
                if (inviteData?.invite_url) {
                    navigator.clipboard.writeText(inviteData.invite_url);
                    setCopySuccess(true);
                    setTimeout(() => setCopySuccess(false), 2000);
                }
            };
            
            const shareWhatsApp = () => {
                if (inviteData?.invite_url) {
                    const text = `üèçÔ∏è Voc√™ foi convidado para fazer entregas!\n\nClique no link para entrar na equipe:\n${inviteData.invite_url}`;
                    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
                }
            };
            
            const getAvatarColor = (name) => {
                const colors = [
                    'rgba(239, 68, 68, 0.15)',
                    'rgba(59, 130, 246, 0.15)',
                    'rgba(34, 197, 94, 0.15)',
                    'rgba(168, 85, 247, 0.15)',
                    'rgba(251, 191, 36, 0.15)',
                ];
                const textColors = ['#f87171', '#60a5fa', '#4ade80', '#a78bfa', '#fbbf24'];
                const index = name.charCodeAt(0) % colors.length;
                return { bg: colors[index], text: textColors[index] };
            };
            
            return (
                <div className="glass-card p-5 mb-6">
                    <h3 className="font-semibold text-white flex items-center gap-2 mb-4" style={{ fontFamily: 'Outfit, sans-serif' }}>
                        üèçÔ∏è Motoqueiros ({couriers.length})
                    </h3>
                    
                    {/* Bot√£o Convite */}
                    <button
                        onClick={createInvite}
                        disabled={inviteLoading}
                        className="w-full mb-4 py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all"
                        style={{ background: 'linear-gradient(135deg, #22c55e, #16a34a)', color: '#fff' }}
                    >
                        {inviteLoading ? '‚è≥ Gerando...' : 'üîó Convidar Motoboy via Link'}
                    </button>
                    
                    {/* Lista de motoboys */}
                    <div className="space-y-3">
                        {couriers.map(courier => {
                            const colors = getAvatarColor(courier.name);
                            return (
                                <div key={courier.id} className="p-3 rounded-xl flex items-center justify-between" style={{ background: 'rgba(255,255,255,0.04)' }}>
                                    <div className="flex items-center gap-3">
                                        <div className="courier-avatar" style={{ background: colors.bg, color: colors.text }}>
                                            {courier.name.charAt(0).toUpperCase()}
                                        </div>
                                        <div>
                                            <div className="text-white font-medium">{courier.name}</div>
                                            <StatusBadge status={courier.status} />
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        {/* Bot√£o Ativar/Pausar com cores */}
                                        <button
                                            onClick={() => toggleStatus(courier)}
                                            className="text-sm py-1.5 px-4 rounded-lg font-medium transition-all"
                                            style={courier.status === 'available' 
                                                ? { background: 'rgba(255, 107, 0, 0.15)', color: '#ff8c42', border: '1px solid rgba(255, 107, 0, 0.3)' }
                                                : { background: 'rgba(34, 197, 94, 0.15)', color: '#4ade80', border: '1px solid rgba(34, 197, 94, 0.3)' }
                                            }
                                        >
                                            {courier.status === 'available' ? 'Pausar' : 'Ativar'}
                                        </button>
                                        
                                        {/* Menu 3 pontinhos */}
                                        <div className="relative">
                                            <button
                                                onClick={() => setOpenMenuId(openMenuId === courier.id ? null : courier.id)}
                                                className="w-8 h-8 rounded-lg flex items-center justify-center transition-all"
                                                style={{ background: 'rgba(255,255,255,0.08)' }}
                                            >
                                                <span style={{ color: 'rgba(255,255,255,0.6)' }}>‚ãÆ</span>
                                            </button>
                                            
                                            {openMenuId === courier.id && (
                                                <div 
                                                    className="absolute right-0 top-10 w-48 rounded-xl overflow-hidden z-50"
                                                    style={{ background: 'rgba(30, 30, 40, 0.98)', border: '1px solid rgba(255,255,255,0.15)', boxShadow: '0 10px 40px rgba(0,0,0,0.4)' }}
                                                >
                                                    <button
                                                        onClick={() => createPasswordReset(courier)}
                                                        className="w-full px-4 py-3 text-left text-sm flex items-center gap-2 transition-all"
                                                        style={{ color: 'rgba(255,255,255,0.8)' }}
                                                        onMouseOver={(e) => e.target.style.background = 'rgba(255,255,255,0.1)'}
                                                        onMouseOut={(e) => e.target.style.background = 'transparent'}
                                                    >
                                                        üîë Recuperar Senha
                                                    </button>
                                                    {courier.status === 'busy' && (
                                                        <button
                                                            onClick={() => completeBatch(courier.id)}
                                                            className="w-full px-4 py-3 text-left text-sm flex items-center gap-2 transition-all"
                                                            style={{ color: '#4ade80' }}
                                                            onMouseOver={(e) => e.target.style.background = 'rgba(255,255,255,0.1)'}
                                                            onMouseOut={(e) => e.target.style.background = 'transparent'}
                                                        >
                                                            ‚úì Finalizar Entrega
                                                        </button>
                                                    )}
                                                    <button
                                                        onClick={() => deleteCourier(courier.id)}
                                                        className="w-full px-4 py-3 text-left text-sm flex items-center gap-2 transition-all"
                                                        style={{ color: '#f87171' }}
                                                        onMouseOver={(e) => e.target.style.background = 'rgba(255,255,255,0.1)'}
                                                        onMouseOut={(e) => e.target.style.background = 'transparent'}
                                                    >
                                                        üóëÔ∏è Excluir
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                        
                        {couriers.length === 0 && (
                            <p className="text-center py-4" style={{ color: 'rgba(255,255,255,0.4)' }}>
                                Nenhum motoboy cadastrado
                            </p>
                        )}
                    </div>
                    
                    {/* Modal de Recupera√ß√£o de Senha */}
                    {showResetModal && resetData && (
                        <div className="modal-overlay" onClick={() => setShowResetModal(false)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <div className="text-center mb-4">
                                    <div className="w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center" style={{ background: 'rgba(59, 130, 246, 0.15)' }}>
                                        <span className="text-3xl">üîë</span>
                                    </div>
                                    <h2 className="text-xl font-bold text-white" style={{ fontFamily: 'Outfit, sans-serif' }}>
                                        Link de Recupera√ß√£o
                                    </h2>
                                    <p className="text-sm mt-1" style={{ color: 'rgba(255,255,255,0.5)' }}>
                                        V√°lido por {resetData.expires_in}
                                    </p>
                                </div>
                                
                                <div className="p-3 rounded-lg mb-4" style={{ background: 'rgba(255,255,255,0.08)' }}>
                                    <p className="text-xs mb-1" style={{ color: 'rgba(255,255,255,0.5)' }}>Link:</p>
                                    <p className="text-sm font-mono break-all text-white">{resetData.reset_url}</p>
                                </div>
                                
                                <div className="space-y-2">
                                    <button
                                        onClick={shareResetWhatsApp}
                                        className="w-full py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2"
                                        style={{ background: '#22c55e', color: '#fff' }}
                                    >
                                        üì± Enviar por WhatsApp
                                    </button>
                                    
                                    <button
                                        onClick={copyResetLink}
                                        className="w-full py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all"
                                        style={{ background: resetCopySuccess ? 'rgba(34,197,94,0.2)' : 'rgba(255,255,255,0.1)', color: resetCopySuccess ? '#4ade80' : '#fff' }}
                                    >
                                        {resetCopySuccess ? '‚úì Link Copiado!' : 'üìã Copiar Link'}
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowResetModal(false)}
                                        className="w-full py-2 text-sm"
                                        style={{ color: 'rgba(255,255,255,0.5)' }}
                                    >
                                        Fechar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Modal de Convite */}
                    {showInviteModal && inviteData && (
                        <div className="modal-overlay" onClick={() => setShowInviteModal(false)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <div className="text-center mb-4">
                                    <div className="w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center" style={{ background: 'rgba(34, 197, 94, 0.15)' }}>
                                        <span className="text-3xl">üîó</span>
                                    </div>
                                    <h2 className="text-xl font-bold text-white" style={{ fontFamily: 'Outfit, sans-serif' }}>
                                        Convite Criado!
                                    </h2>
                                    <p className="text-sm mt-1" style={{ color: 'rgba(255,255,255,0.5)' }}>
                                        V√°lido por {inviteData.expires_in}
                                    </p>
                                </div>
                                
                                <div className="p-3 rounded-lg mb-4" style={{ background: 'rgba(255,255,255,0.08)' }}>
                                    <p className="text-xs mb-1" style={{ color: 'rgba(255,255,255,0.5)' }}>Link:</p>
                                    <p className="text-sm font-mono break-all text-white">{inviteData.invite_url}</p>
                                </div>
                                
                                <div className="space-y-2">
                                    <button
                                        onClick={shareWhatsApp}
                                        className="w-full py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2"
                                        style={{ background: '#22c55e', color: '#fff' }}
                                    >
                                        üì± Enviar por WhatsApp
                                    </button>
                                    
                                    <button
                                        onClick={copyLink}
                                        className="w-full py-3 px-4 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all"
                                        style={{ background: copySuccess ? 'rgba(34,197,94,0.2)' : 'rgba(255,255,255,0.1)', color: copySuccess ? '#4ade80' : '#fff' }}
                                    >
                                        {copySuccess ? '‚úì Link Copiado!' : 'üìã Copiar Link'}
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowInviteModal(false)}
                                        className="w-full py-2 text-sm"
                                        style={{ color: 'rgba(255,255,255,0.5)' }}
                                    >
                                        Fechar
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };
        
        // ============ COMPONENTE: ROTAS ATIVAS ============
        
        const ActiveBatches = ({ batches }) => {
            if (!batches || batches.length === 0) {
                return (
                    <div className="glass-card p-5">
                        <h3 className="font-semibold text-white flex items-center gap-2 mb-4" style={{ fontFamily: 'Outfit, sans-serif' }}>
                            üöÄ Rotas Ativas
                        </h3>
                        <p className="text-center py-4" style={{ color: 'rgba(255,255,255,0.4)' }}>
                            Nenhuma rota ativa
                        </p>
                    </div>
                );
            }
            
            return (
                <div className="glass-card p-5">
                    <h3 className="font-semibold text-white flex items-center gap-2 mb-4" style={{ fontFamily: 'Outfit, sans-serif' }}>
                        üöÄ Rotas Ativas ({batches.length})
                    </h3>
                    <div className="space-y-3">
                        {batches.map(batch => (
                            <div key={batch.id} className="p-4 rounded-xl" style={{ background: 'rgba(255,255,255,0.04)' }}>
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-white font-medium">{batch.courier_name}</span>
                                    <span className="badge badge-info">{batch.orders?.length || 0} entregas</span>
                                </div>
                                <div className="text-sm" style={{ color: 'rgba(255,255,255,0.4)' }}>
                                    üìç {batch.orders?.map(o => o.address_text?.split(',')[0]).join(' ‚Üí ')}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        
        // ============ COMPONENTE: DISPATCH CONTROL ============
        
        const DispatchControl = ({ onDispatch, stats }) => {
            const [loading, setLoading] = useState(false);
            const [lastResult, setLastResult] = useState(null);
            
            const runDispatch = async () => {
                setLoading(true);
                try {
                    const res = await authFetch(`${API_URL}/dispatch/run`, { method: 'POST' });
                    const result = await res.json();
                    setLastResult(result);
                    onDispatch();
                } catch (err) {
                    setLastResult({ message: 'Erro ao executar dispatch' });
                }
                setLoading(false);
            };
            
            const canDispatch = stats && stats.orders?.ready > 0 && stats.couriers?.available > 0;
            
            return (
                <div className="glass-card p-5 mb-6" style={{ borderColor: 'rgba(255,107,0,0.3)', borderWidth: '2px' }}>
                    <div className="flex items-center justify-between flex-wrap gap-4">
                        <div>
                            <h3 className="font-semibold flex items-center gap-2" style={{ color: '#ff8c42', fontFamily: 'Outfit, sans-serif' }}>
                                üöÄ Dispatch - Distribuir Pedidos
                            </h3>
                            <p className="text-sm mt-1" style={{ color: 'rgba(255,255,255,0.5)' }}>
                                {stats?.orders?.ready || 0} pronto(s) ¬∑ {stats?.couriers?.available || 0} motoboy(s)
                            </p>
                        </div>
                        <button 
                            onClick={runDispatch} 
                            disabled={loading || !canDispatch}
                            className="btn-primary text-lg px-6 py-3"
                        >
                            {loading ? '‚è≥...' : 'üöÄ Executar'}
                        </button>
                    </div>
                    
                    {lastResult && (
                        <div 
                            className="mt-3 p-3 rounded-lg"
                            style={{ 
                                background: lastResult.batches_created > 0 ? 'rgba(34,197,94,0.15)' : 'rgba(255,255,255,0.08)',
                                color: lastResult.batches_created > 0 ? '#4ade80' : 'rgba(255,255,255,0.6)'
                            }}
                        >
                            {lastResult.message}
                        </div>
                    )}
                </div>
            );
        };
        
        // ============ SIDEBAR ============
        
        const Sidebar = ({ currentPage, setCurrentPage, restaurantName, onLogout, stats, sidebarOpen, setSidebarOpen }) => {
            const navItems = [
                { id: 'inicio', icon: 'üè†', label: 'In√≠cio' },
                { id: 'pedidos', icon: 'üì¶', label: 'Pedidos', badge: stats?.orders?.ready },
                { id: 'motoboys', icon: 'üèçÔ∏è', label: 'Motoqueiros' },
            ];
            
            const manageItems = [
                { id: 'cardapio', icon: 'üçΩÔ∏è', label: 'Card√°pio' },
                { id: 'clientes', icon: 'üë•', label: 'Clientes' },
                { id: 'relatorios', icon: 'üìä', label: 'Relat√≥rios' },
            ];
            
            const systemItems = [
                { id: 'configuracoes', icon: '‚öôÔ∏è', label: 'Configura√ß√µes' },
                { id: 'ajuda', icon: '‚ùì', label: 'Ajuda' },
            ];
            
            const NavItem = ({ item }) => (
                <div
                    onClick={() => {
                        setCurrentPage(item.id);
                        setSidebarOpen(false);
                    }}
                    className={`nav-item ${currentPage === item.id ? 'active' : ''}`}
                >
                    <span className="nav-icon">{item.icon}</span>
                    <span>{item.label}</span>
                    {item.badge > 0 && <span className="nav-badge">{item.badge}</span>}
                </div>
            );
            
            return (
                <aside className={`sidebar ${sidebarOpen ? 'open' : ''}`}>
                    {/* Logo */}
                    <div className="sidebar-header">
                        <div className="flex items-center gap-3">
                            <svg width="40" height="40" viewBox="0 0 80 80" fill="none">
                                <circle cx="40" cy="40" r="34" fill="#FF6B00"/>
                                <path d="M44 12 L28 40 L38 40 L32 68 L56 36 L44 36 L52 12 Z" fill="white"/>
                            </svg>
                            <div>
                                <h1 className="text-lg font-bold" style={{ fontFamily: 'Outfit, sans-serif' }}>
                                    <span className="text-white">Moto</span>
                                    <span className="text-gradient-orange">Flash</span>
                                </h1>
                                <p className="text-xs" style={{ color: 'rgba(255,255,255,0.4)' }}>Despacho Inteligente</p>
                            </div>
                        </div>
                    </div>
                    
                    {/* Navigation */}
                    <nav className="sidebar-nav">
                        <div className="nav-section">
                            <div className="nav-section-title">Principal</div>
                            {navItems.map(item => <NavItem key={item.id} item={item} />)}
                        </div>
                        
                        <div className="nav-section">
                            <div className="nav-section-title">Gerenciar</div>
                            {manageItems.map(item => <NavItem key={item.id} item={item} />)}
                        </div>
                        
                        <div className="nav-section">
                            <div className="nav-section-title">Sistema</div>
                            {systemItems.map(item => <NavItem key={item.id} item={item} />)}
                        </div>
                    </nav>
                    
                    {/* User Card */}
                    <div className="sidebar-footer">
                        <div className="user-card">
                            <div className="user-avatar">
                                {restaurantName.charAt(0).toUpperCase()}
                            </div>
                            <div className="user-info">
                                <div className="user-name">{restaurantName}</div>
                                <div className="user-status">
                                    <span className="status-dot"></span>
                                    Conectado
                                </div>
                            </div>
                            <button 
                                onClick={onLogout}
                                style={{ color: 'rgba(255,255,255,0.5)', background: 'none', border: 'none', cursor: 'pointer', fontSize: '12px' }}
                                title="Sair"
                            >
                                Sair
                            </button>
                        </div>
                    </div>
                </aside>
            );
        };
        
        // ============ P√ÅGINA: IN√çCIO (DASHBOARD) ============
        
        const DashboardPage = ({ stats, alerts, recommendation, orders, couriers, batches, fetchAll, simulatedDate }) => {
            return (
                <>
                    <StatsPanel stats={stats} />
                    <AlertsPanel alerts={alerts} recommendation={recommendation} />
                    
                    <div className="grid lg:grid-cols-3 gap-6 mb-6">
                        <div className="lg:col-span-2">
                            <NewOrderForm onOrderCreated={fetchAll} simulatedDate={simulatedDate} />
                            <DispatchControl onDispatch={fetchAll} stats={stats} />
                        </div>
                        
                        <div>
                            <CouriersPanel couriers={couriers} onRefresh={fetchAll} />
                            <ActiveBatches batches={batches} />
                        </div>
                    </div>
                    
                    {/* Lista de Pedidos em 3 colunas - ocupa toda a largura */}
                    <OrdersList orders={orders} onRefresh={fetchAll} />
                </>
            );
        };
        
        // ============ P√ÅGINAS PLACEHOLDER ============
        
        const PlaceholderPage = ({ title, icon }) => (
            <div className="glass-card p-8 text-center">
                <div className="text-6xl mb-4">{icon}</div>
                <h2 className="text-2xl font-bold text-white mb-2" style={{ fontFamily: 'Outfit, sans-serif' }}>{title}</h2>
                <p style={{ color: 'rgba(255,255,255,0.5)' }}>
                    Esta funcionalidade ser√° implementada em breve!
                </p>
            </div>
        );
        
        // ============ APP PRINCIPAL ============
        
        function MotoFlashApp() {
            const [currentPage, setCurrentPage] = useState('inicio');
            const [sidebarOpen, setSidebarOpen] = useState(false);
            
            // Dados
            const [orders, setOrders] = useState([]);
            const [couriers, setCouriers] = useState([]);
            const [batches, setBatches] = useState([]);
            const [stats, setStats] = useState(null);
            const [alerts, setAlerts] = useState(null);
            const [recommendation, setRecommendation] = useState(null);
            const [connected, setConnected] = useState(false);
            
            // Restaurante
            const [restaurantName, setRestaurantName] = useState(() => {
                const data = localStorage.getItem('motoflash_restaurant');
                if (data) {
                    try {
                        return JSON.parse(data).name || 'Restaurante';
                    } catch { return 'Restaurante'; }
                }
                return 'Restaurante';
            });
            
            // Data simulada
            const [simulatedDate, setSimulatedDate] = useState(() => {
                return new Date().toISOString().split('T')[0];
            });
            
            const handleLogout = () => {
                localStorage.removeItem('motoflash_token');
                localStorage.removeItem('motoflash_user');
                localStorage.removeItem('motoflash_restaurant');
                window.location.href = '/login';
            };
            
            const fetchAll = useCallback(async () => {
                try {
                    const [ordersRes, couriersRes, batchesRes, statsRes, alertsRes, recoRes] = await Promise.all([
                        authFetch(`${API_URL}/orders?limit=50`),
                        authFetch(`${API_URL}/couriers`),
                        authFetch(`${API_URL}/dispatch/batches`),
                        authFetch(`${API_URL}/dispatch/stats`),
                        authFetch(`${API_URL}/dispatch/alerts`),
                        authFetch(`${API_URL}/dispatch/recommendation`),
                    ]);
                    
                    if (ordersRes.ok) setOrders(await ordersRes.json());
                    if (couriersRes.ok) setCouriers(await couriersRes.json());
                    if (batchesRes.ok) setBatches(await batchesRes.json());
                    if (statsRes.ok) setStats(await statsRes.json());
                    if (alertsRes.ok) setAlerts(await alertsRes.json());
                    if (recoRes.ok) setRecommendation(await recoRes.json());
                    
                    setConnected(true);
                } catch (err) {
                    if (err.message !== 'N√£o autenticado' && err.message !== 'Sess√£o expirada') {
                        setConnected(false);
                    }
                }
            }, []);
            
            useEffect(() => {
                fetchAll();
                const interval = setInterval(fetchAll, 5000);
                return () => clearInterval(interval);
            }, [fetchAll]);
            
            const getPageTitle = () => {
                const titles = {
                    inicio: 'Dashboard',
                    pedidos: 'Pedidos',
                    motoboys: 'Motoqueiros',
                    cardapio: 'Card√°pio',
                    clientes: 'Clientes',
                    relatorios: 'Relat√≥rios',
                    configuracoes: 'Configura√ß√µes',
                    ajuda: 'Ajuda',
                };
                return titles[currentPage] || 'Dashboard';
            };
            
            const renderPage = () => {
                switch (currentPage) {
                    case 'inicio':
                        return (
                            <DashboardPage 
                                stats={stats}
                                alerts={alerts}
                                recommendation={recommendation}
                                orders={orders}
                                couriers={couriers}
                                batches={batches}
                                fetchAll={fetchAll}
                                simulatedDate={simulatedDate}
                            />
                        );
                    case 'pedidos':
                        return <PlaceholderPage title="Pedidos" icon="üì¶" />;
                    case 'motoboys':
                        return <PlaceholderPage title="Motoqueiros" icon="üèçÔ∏è" />;
                    case 'cardapio':
                        return <PlaceholderPage title="Card√°pio" icon="üçΩÔ∏è" />;
                    case 'clientes':
                        return <PlaceholderPage title="Clientes" icon="üë•" />;
                    case 'relatorios':
                        return <PlaceholderPage title="Relat√≥rios" icon="üìä" />;
                    case 'configuracoes':
                        return <PlaceholderPage title="Configura√ß√µes" icon="‚öôÔ∏è" />;
                    case 'ajuda':
                        return <PlaceholderPage title="Ajuda" icon="‚ùì" />;
                    default:
                        return <DashboardPage {...{ stats, alerts, recommendation, orders, couriers, batches, fetchAll, simulatedDate }} />;
                }
            };
            
            return (
                <>
                    <Sidebar 
                        currentPage={currentPage}
                        setCurrentPage={setCurrentPage}
                        restaurantName={restaurantName}
                        onLogout={handleLogout}
                        stats={stats}
                        sidebarOpen={sidebarOpen}
                        setSidebarOpen={setSidebarOpen}
                    />
                    
                    <div className="main-wrapper">
                        {/* Header */}
                        <header className="glass-header">
                            <div className="px-6 py-4">
                                <div className="flex items-center justify-between">
                                    {/* Mobile menu */}
                                    <button 
                                        className="mobile-menu-btn"
                                        onClick={() => setSidebarOpen(!sidebarOpen)}
                                    >
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                            <path d="M3 12h18M3 6h18M3 18h18"/>
                                        </svg>
                                    </button>
                                    
                                    {/* Title */}
                                    <div>
                                        <h1 className="text-xl font-bold text-white" style={{ fontFamily: 'Outfit, sans-serif' }}>
                                            {getPageTitle()}
                                        </h1>
                                        <p className="text-sm" style={{ color: 'rgba(255,255,255,0.5)' }}>
                                            Vis√£o geral das opera√ß√µes
                                        </p>
                                    </div>
                                    
                                    {/* Right side */}
                                    <div className="flex items-center gap-4">
                                        {/* Data simulada */}
                                        <div className="hidden md:flex items-center gap-2 px-3 py-2 rounded-lg" style={{ background: 'rgba(255,107,0,0.15)', border: '1px solid rgba(255,107,0,0.3)' }}>
                                            <span style={{ color: '#ff8c42' }}>üìÖ</span>
                                            <input
                                                type="date"
                                                value={simulatedDate}
                                                onChange={(e) => setSimulatedDate(e.target.value)}
                                                className="bg-transparent border-none text-white text-sm focus:outline-none"
                                                style={{ colorScheme: 'dark' }}
                                            />
                                        </div>
                                        
                                        {/* Status */}
                                        <div className="flex items-center gap-2">
                                            <div className={`w-2 h-2 rounded-full ${connected ? 'bg-green-500' : 'bg-red-500'}`} />
                                            <span className="text-sm" style={{ color: 'rgba(255,255,255,0.5)' }}>
                                                {connected ? 'Online' : 'Offline'}
                                            </span>
                                        </div>
                                        
                                        {/* Notifica√ß√µes */}
                                        <button className="w-10 h-10 rounded-xl flex items-center justify-center" style={{ background: 'rgba(255,255,255,0.08)' }}>
                                            üîî
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </header>
                        
                        {/* Main Content */}
                        <main className="p-6">
                            {renderPage()}
                        </main>
                        
                        {/* Footer */}
                        <footer className="text-center py-6" style={{ color: 'rgba(255,255,255,0.25)' }}>
                            MotoFlash MVP v0.4 - Sistema de Despacho Inteligente
                        </footer>
                    </div>
                </>
            );
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(<MotoFlashApp />);
    </script>
</body>
</html>